# Control input file is not needed when run from a go:generate comment.
go build -C $BITFIELD_DIR -o $TMPDIR/bitfield
go generate
! stderr .
! stdout .
cmp $WORK/out.go want.go

-- in.go --
package testpkg

//go:generate $TMPDIR/bitfield -out out.go

type A struct {
	CoarseX    uint8 `bitfield:"2"`
	CoarseY    uint8 `bitfield:"3"`
}

-- go.mod --
module myprog

go 1.14
-- want.go --
package testpkg

// Code generated by github.com/arl/bitfield. DO NOT EDIT.

type A uint8

func (a A) CoarseX() uint8 {
	return uint8(a & 0x3)
}

func (a *A) SetCoarseX(val uint8) {
	*a &^= 0x3
	*a |= A(val & 0x3)
}

func (a A) CoarseY() uint8 {
	return uint8((a >> 2) & 0x7)
}

func (a *A) SetCoarseY(val uint8) {
	*a &^= 0x7 << 2
	*a |= A(val&0x7) << 2
}
