# Control we generate union in order of appearance.
go build -C $BITFIELD_DIR -o $TMPDIR/bitfield
exec $TMPDIR/bitfield -in in.go -out out.go
! stderr .
cmp out.go want.go

-- in.go --
package testpkg

type A struct {
	F1    uint8 `bitfield:"2,union=a"`
	F2    uint8 `bitfield:"3,union=b"`
	F3    uint8 `bitfield:"3,union=a"`
	F4    uint8 `bitfield:"2,union=b"`
}

-- want.go --
package testpkg

// Code generated by github.com/arl/bitfield. DO NOT EDIT.

type A uint8

func (a A) F1() uint8 {
	return uint8(a & 0x3)
}

func (a *A) SetF1(val uint8) {
	*a &^= 0x3
	*a |= A(val & 0x3)
}

func (a A) F3() uint8 {
	return uint8((a >> 2) & 0x7)
}

func (a *A) SetF3(val uint8) {
	*a &^= 0x7 << 2
	*a |= A(val&0x7) << 2
}

func (a A) F2() uint8 {
	return uint8(a & 0x7)
}

func (a *A) SetF2(val uint8) {
	*a &^= 0x7
	*a |= A(val & 0x7)
}

func (a A) F4() uint8 {
	return uint8((a >> 3) & 0x3)
}

func (a *A) SetF4(val uint8) {
	*a &^= 0x3 << 3
	*a |= A(val&0x3) << 3
}
